AWSTemplateFormatVersion: "2010-09-09"
Description: this is WeatherApp using s3 , Lambda and APIgateway
Resources: 
    LambdaExecutionRole: 
      Type: 'AWS::IAM::Role'
      Properties:
        AssumeRolePolicyDocument:
          Version: "2012-10-17"
          Statement:
            - Effect: Allow
              Principal:
                Service:
                  - lambda.amazonaws.com
                  - s3.amazonaws.com
                  - dynamodb.amazonaws.com
              Action:
                - 'sts:AssumeRole'
        Description: IAM role for lambda to access s3 and dynamodb
        ManagedPolicyArns:
          - arn:aws:iam::aws:policy/AmazonS3FullAccess
          - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
          - arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess
        RoleName: LambdaExecutionRole1

    LambdaFunctionSpringFunction:
      UpdateReplacePolicy: "Retain"
      DependsOn: LambdaExecutionRole
      Type: "AWS::Lambda::Function"
      DeletionPolicy: "Retain"
      Properties:
        MemorySize: 512
        Description: ""
        TracingConfig:
          Mode: "PassThrough"
        Timeout: 15
        RuntimeManagementConfig:
          UpdateRuntimeOn: "Auto"
        Handler: "org.example.StreamLambdaHandler::handleRequest"
        Code:
          S3Bucket: aws-weather-app-bucket
          S3Key: my-new-case-study-1.0-SNAPSHOT-lambda-package.zip
        Role: !GetAtt LambdaExecutionRole.Arn
        FileSystemConfigs: []
        FunctionName: "SpringFunction"
        Runtime: "java21"
        PackageType: "Zip"
        LoggingConfig:
          LogFormat: "Text"
          LogGroup: "/aws/lambda/SpringFunction"
        RecursiveLoop: "Terminate"
        EphemeralStorage:
          Size: 512
        Architectures:
          - "x86_64"

     DynamoDBTableWeatherData:
          UpdateReplacePolicy: "Retain"
          Type: "AWS::DynamoDB::Table"
          DeletionPolicy: "Retain"
          Properties:
            SSESpecification:
              SSEEnabled: false
            TableName: "WeatherData"
            AttributeDefinitions:
            - AttributeType: "S"
              AttributeName: "id"
            ContributorInsightsSpecification:
              Enabled: false
            BillingMode: "PAY_PER_REQUEST"
            PointInTimeRecoverySpecification:
              PointInTimeRecoveryEnabled: false
            KeySchema:
            - KeyType: "HASH"
              AttributeName: "id"
            DeletionProtectionEnabled: false
            TableClass: "STANDARD"
            Tags: []
            TimeToLiveSpecification:
              Enabled: false
          
     weatherRestAPI:
           Type: AWS::ApiGateway::RestApi
           Properties:
              Name: weatherdataAPI
    
        
    
    
  






    

   
